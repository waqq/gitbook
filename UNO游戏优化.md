# H5游戏优化与问题解决

#### 一、架构层优化

###### 1、模块化开发

uno是利用fis搭建的，项目结构比较简单，逻辑处理与界面代码都是融合在一起，代码结构很乱，没有进行模块化开发，一个新功能来了，经常会出现需要去修改老的模块的功能，然后功能迭代时需要去处理别的功能的代码

优化：
模块划分+数据存储+逻辑处理+事件驱动+规范化

首先以一个游戏场景作为一个模块，每个模块包含数据管理器、逻辑控制器、界面渲染器。

1. 逻辑控制器控制该模块的数据交互和模块间交互；
2. 数据管理器负责该模块的数据存储与数据处理；
3. 界面渲染器负责模块界面渲染与交互。

每个模块的数据管理器和逻辑控制器是在一开始就初始化的，所以会有很多地方需要进行模块间交互，这时一开始是需要进行目标存不存在的判断，改成事件驱动后就不需要进行这样的判断，减少了模块间的代码耦合

项目规范化，提高代码的可读性和可维护性，包含代码规范化和模块结构规范化

###### 2、游戏加载优化

一开始游戏加载机制是 zip包加载+分大模块加载（首包+通用包+场景包）

后来优化成 图集加载+按需加载（首包+通用包+场景包+弹窗包）

**优化的好处：**

1. 避免zip包解压失败，导致某些图片加载失败；
2. 提高进入游戏速度，按需加载减少了首包和通用包体积从而加快了打开游戏的速度
3. 避免不必要的加载，把场景资源和弹窗资源分开，当打开弹窗时才去加载

###### 3、动画开发工具搭建

phaser是一款轻量级的2D游戏引擎，官方没有提供可视化的UI编辑器，界面所有的开发都是通过js来搭建出来，在开发动画时非常影响开发效率。借鉴Laya的动画机制，在laya的动画编辑器中将动画在timeline中编辑好，导出包含每帧动画节点所处状态的json文件，然后通过解析脚本通过phaser的tween将每帧衔接到一起，这样实现最后的动画。

###### 4、图片渲染

在平时开发中，美术经常会给一些周边留白很多的透明图片，之前是直接放进资源包中加载使用，因为透明部分不会影响资源大小，但后来发现在浏览器渲染图片时，透明像素点也会消耗浏览器的内存，后来在打包图集时，把留白去掉了，phaser根据资源在图集中的trimmed属性会选择留白渲染

5、点击

6、九宫格